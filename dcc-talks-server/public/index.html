<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Chat dccTalks</title>	
	<link rel="stylesheet" type="text/css" href="/main.css">
	<script src="/socket.io/socket.io.js"></script>
	<script type="text/javascript" src="jquery-3.3.1.min.js"></script>

</head>	
<body>
	<h2>Página HTML</h2> 
			
	<h3>Arquivo de teste do servidor</h3>

	<div id='acesso_usuario'>
		<form id='login'>
			<input type='text' placeholder='Insira seu apelido' name='apelido' id='apelido' />
			<input type='submit' value='Entrar' />
		</form>
	</div>
		
	<div id="sala_chat">
	<div id="messages">
	</div>		
	<form id="chat">
        <input type='text' id='texto_mensagem' name='texto_mensagem' />
        <input type='submit' value='Enviar mensagem!' />    
    </form>
	</div>

	<script>
		$(document).ready(function(){
  			var socket = io();
  				
  			$("form#login").submit(function(e){
				e.preventDefault();
				
			
				// Evento enviado quando o usuário insere um apelido
			socket.emit("entrar", $(this).find("#apelido").val(), function(valido){
				if(valido == true){
					$("#acesso_usuario").hide();
					$("#sala_chat").show();
				}
			});

			});
 				$('form#chat').submit(function(e){
	            e.preventDefault();
	            socket.emit("chat_message_send", $(this).find("#texto_mensagem").val(), function(){
	                $("form#chat #texto_mensagem").val("");
	            });
	        });		

 			socket.on('chat_message_update', function(msg){ //recebe msg tempo real
	    	  	$('#messages').append($('<p>').html(msg));
		    });
		    	
			 socket.on('chat_message_history', function(msg){ //recebe historico msgs
				console.log(msg.msg);
 				$('#messages').append($('<p>').html(msg.msg));
 			});	
			

	});
	</script>


			
</body>
</html>

		